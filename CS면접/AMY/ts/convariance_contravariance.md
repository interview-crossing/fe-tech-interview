## 타입스크립트의 공변성과 반공변성

타입스크립트로 코딩을 하는 도중 타입 간의 관계로 인한 오류 때문에 당황스러운 상황을 맞닥뜨린 적이 있을 것입니다.
예를 들면, 어떤 타입은 다른 타입에 들어가는데 어떤 타입은 안 들어가 결과가 다르게 나온다거나, strict-mode가 적용되었을 때 반환값과 매개변수의 타입 차이로 인한 오류가 발생했을 수도 있습니다.

이러한 오류는 타입스크립트의 공변성과 반공변성에 대해 알게 되면 이해할 수 있는 부분입니다.

##### 개념 잡고 가기

#### 공변성 (Covariance)

- `A가 B의 서브타입이면, T<A>는 T<B>의 서브타입`
- `A ⊂ B → T<A> ⊂ T<B>`

공변성([共變性 (함께 공, 변할 변, 성품 성)])이란 한 변수가 변하면 다른 변수도 변하는 성질을 말합니다.
어떤 타입의 생성자가 "하위 타입에도 호환이 가능"한 경우를 '공변적이다' 라고 표현할 수 있습니다.

<br/>

#### 반공변성 (Contravariance)

- `A가 B의 서브타입이면, T<B>는 T<A>의 서브타입`
- `A ⊂ B → T<B> ⊂ T<A>`

반대로, 반공변성은 어떤 타입 생성자가 "상위 타입에도 호환이 가능"할 때 '반공변적이다'라고 할 수 있습니다.
매개변수가 더 넓은 범위로 받을 수 있어야 안전하기 때문에 일반적으로 함수의 매개변수 타입이 반공변성을 띱니다.

공변성 규칙이 함수의 매개변수로 전달된 경우, 반대로 동작하게 됩니다.

<br/>
<br/>

대개 "함수의 반환 값"은 공변적(covariant)이고, "함수의 매개변수"는 반공변적(contravariant)이라고 설명합니다.

타입스크립트에서 타입들은 기본적으로 공변성 규칙을 따르지만, 유일하게 함수의 매개변수는 반공변성을 띤다는 특징이 있습니다. <br/>
단, 이는 strict-mode 기준이며 엄격한 모드가 아니라면 함수의 매개변수는 이변성을 띠게 됩니다.

<br/>
<br/>

###### 연관 개념

#### 이변성 (Bivariance)

- `A가 B의 서브타입이라면 T<A> → T<B>도 되고 T<B> → T<A>도 가능`

타입스크립트는 기본적으로 함수의 인자를 다루는 과정에서 이변성 구조를 갖고 있습니다. 
매개변수가 이변성을 갖는 이유는 리턴 값으로 공변성을 갖는데 반해 매개변수는 반공변성을 가짐으로써 생기는 문제들이 많기 때문입니다.

타입스크립트 설정을 느슨하게 풀면(strict-mode를 해제하면) 매개변수 타입이 다른 함수끼리 대입이 가능해지는 것을 확인할 수 있습니다.
이것을 이변성이라 합니다.

따라서 이변성은 타입의 안전성보다 코딩의 편의성을 우선시한 설계라고 볼 수 있습니다.



<br/>

#### 불변성 (Immutability)

- `A가 B의 서브타입이라도 T<A> → T<B>도 T<B> → T<A>도 불가능`

불변성이라는 표현은 일반적으로 값을 변경할 수 없다는 의미로 쓰입니다.
하지만 타입 이론에서 말하는 불변성은 "서브 타입 관계의 대입 허용 여부"에 관한 것입니다.

<br/>

#### 무공변성

- `A와 B는 서로 관계가 없으므로 T<A>와 T<B>는 서로 다른 타입`

제네릭은 대부분의 경우 무공변성을 띄기 때문에 제네릭의 타입 파라미터끼리는 타입이 아무리 상속 관계에 놓인다 하더라도 캐스팅(casting)이 불가능합니다.
따라서 매개변수로 제네릭을 사용할 때, 외부에서 대입ㅇ되는 인자의 캐스팅 문제로 인해 에러가 발생할 수 있습니다.



<br/>
<br/>
<hr/>

###### References.

- [[Inpa Dev]타입스크립트 공변성 & 반공변성 완벽 이해](https://inpa.tistory.com/entry/TS-%F0%9F%93%98-%ED%83%80%EC%9E%85%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EA%B3%B5%EB%B3%80%EC%84%B1-%EB%B0%98%EA%B3%B5%EB%B3%80%EC%84%B1-%F0%9F%92%A1-%ED%95%B5%EC%8B%AC-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0)
- [[velog][우아한타입스크립트] 공변성과 반공변성 완전 이해하기](https://velog.io/@hwangyena/%EC%9A%B0%EC%95%84%ED%95%9C%ED%83%80%EC%9E%85%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%EA%B3%B5%EB%B3%80%EC%84%B1%EA%B3%BC-%EB%B0%98%EA%B3%B5%EB%B3%80%EC%84%B1-%EC%99%84%EC%A0%84-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0)
- [[tistory]제네릭(5)-공변성, 반공변성, 무공변성](https://shuu.tistory.com/77)
